<% layout("layouts/boilerplate") %>

<div class="container mt-5">
  <h1 class="display-4">Update Recipe</h1>
  <form action="/recipes/<%= recipe._id %>?_method=PUT" method="POST">
    <div class="form-group">
      <label for="title">Title</label>
      <input type="text" class="form-control" id="title" name="recipe[title]" value="<%= recipe.title %>" required minlength="3" maxlength="100">
    </div>

    <div class="form-group">
      <label for="image">Image URL</label>
      <input type="url" class="form-control" id="image" name="recipe[image]" value="<%= recipe.image %>">
    </div>

    <div class="form-group">
      <label for="prep_time">Preparation Time (minutes)</label>
      <input type="number" class="form-control" id="prep_time" name="recipe[prep_time]" min="0" value="<%= recipe.prep_time %>">
    </div>

    <div class="form-group">
      <label for="cook_time">Cooking Time (minutes)</label>
      <input type="number" class="form-control" id="cook_time" name="recipe[cook_time]" min="0" value="<%= recipe.cook_time %>">
    </div>

    <div class="form-group">
      <label for="servings">Servings</label>
      <input type="number" class="form-control" id="servings" name="recipe[servings]" min="1" value="<%= recipe.servings %>">
    </div>

    <div class="form-group">
      <label for="difficulty">Difficulty</label>
      <select class="form-control" id="difficulty" name="recipe[difficulty]">
        <option value="Easy" <%= recipe.difficulty === 'Easy' ? 'selected' : '' %>>Easy</option>
        <option value="Medium" <%= recipe.difficulty === 'Medium' ? 'selected' : '' %>>Medium</option>
        <option value="Hard" <%= recipe.difficulty === 'Hard' ? 'selected' : '' %>>Hard</option>
      </select>
    </div>

    <div class="form-group">
      <label>Ingredients</label>
      <ol id="ingredients">
        <% recipe.ingredients.forEach(function(ingredient, index) { %>
          <li class="ingredient form-row mb-3">
            <div class="col">
              <input type="text" class="form-control" name="recipe[ingredients][<%= index %>][ingredient]" placeholder="Ingredient" value="<%= ingredient.ingredient %>" required>
            </div>
            <div class="col">
              <input type="number" class="form-control" name="recipe[ingredients][<%= index %>][quantity]" placeholder="Quantity" min="0.01" step="any" value="<%= ingredient.quantity %>" required>
            </div>
            <button type="button" class="btn btn-danger remove-ingredient">Remove</button>
          </li>
        <% }); %>
      </ol>
      <button type="button" class="btn btn-primary mb-3" id="add-ingredient">Add Ingredient</button>
    </div>

    <div class="form-group">
      <label>Directions</label>
      <ol id="directions">
        <% recipe.directions.forEach(function(direction, index) { %>
          <li class="direction form-row mb-3">
            <div class="col">
              <textarea class="form-control" name="recipe[directions][<%= index %>]" required><%= direction %></textarea>
            </div>
            <button type="button" class="btn btn-danger remove-direction">Remove</button>
          </li>
        <% }); %>
      </ol>
      <button type="button" class="btn btn-primary mb-3" id="add-direction">Add Direction</button>
    </div>

    <div class="form-group">
      <label for="calories">Calories</label>
      <input type="number" class="form-control" id="calories" name="recipe[nutrition][calories]" min="0" value="<%= recipe.nutrition.calories %>">
    </div>

    <div class="form-group">
      <label for="fat">Fat (grams)</label>
      <input type="number" class="form-control" id="fat" name="recipe[nutrition][fat]" min="0" value="<%= recipe.nutrition.fat %>">
    </div>

    <div class="form-group">
      <label for="protein">Protein (grams)</label>
      <input type="number" class="form-control" id="protein" name="recipe[nutrition][protein]" min="0" value="<%= recipe.nutrition.protein %>">
    </div>

    <div class="form-group">
      <label for="carbs">Carbs (grams)</label>
      <input type="number" class="form-control" id="carbs" name="recipe[nutrition][carbs]" min="0" value="<%= recipe.nutrition.carbs %>">
    </div>

    <div class="form-group">
      <label for="tags">Tags</label>
      <input type="text" class="form-control" id="tags" name="recipe[tags]" placeholder="Comma separated tags" value="<%= recipe.tags.join(', ') %>">
    </div>

    <button type="submit" class="btn btn-primary">Update Recipe</button>
  </form>

  <form action="/recipes/<%= recipe._id %>?_method=DELETE" method="POST" class="mt-3">
    <button type="submit" class="btn btn-danger">Delete</button>
  </form>
  
  <a href="/recipes" class="btn btn-warning">Back to All Recipes</a>
</div>

<script src="/javascripts/forms.js"></script>
